<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weekly Diet Plans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Weekly Diet Plans</h1>
    </header>

    <main>
        <div class="week-selector">
            <label for="weekSelector">Select Week:</label>
            <select id="weekSelector">
                <option value="week1">Week 1</option>
                <option value="week2">Week 2</option>
            </select>
        </div>
        <div id="planContent">Loading...</div>
    </main>

    <footer>
        <p>Healthy Diet Plans &copy; 2025</p>
    </footer>

    <script>
    function escapeHtml(text) {
        return text.replace(/[<>&"]/g, function(c) {
            return {'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;'}[c];
        });
    }

    function parseDietFileToHtml(text) {
        // Split at RECIPES (case-insensitive)
        const [chartBlockRaw, recipesBlockRaw] = text.split(/RECIPES/i);
        // === DIET CHART TABLE ===
        const mealLines = chartBlockRaw.split('\n').filter(
            line => line.match(/:\s*/) && line.includes('(')
        );
        let tableRows = '';
        mealLines.forEach(line => {
            const match = line.match(/^(.+?):\s*(.+)\(([^)]+)\)$/);
            if (match) {
                tableRows += `<tr>
                    <td>${escapeHtml(match[1])}</td>
                    <td>${escapeHtml(match[3])}</td>
                    <td>${escapeHtml(match[2].trim().replace(/,$/,'').replace(/\s+$/, ''))}</td>
                </tr>`;
            }
        });
        let tableHtml = `
        <div class="diet-week-table">
            <table>
                <thead>
                    <tr><th>Meal</th><th>Time</th><th>Menu</th></tr>
                </thead>
                <tbody>
                ${tableRows}
                </tbody>
            </table>
        </div>`;

        // === RECIPES SECTION ===
        let recipesHtml = '<div class="recipes-section"><h2>Recipes</h2>';
        if (recipesBlockRaw) {
            // Split by blank lines, then parse each recipe
            recipesBlockRaw.trim().split(/\n\s*\n/).forEach(recipeBlk => {
                if (!recipeBlk.trim()) return;
                let lines = recipeBlk.trim().split("\n");
                let title = lines[0] || "";
                let ingredients = lines.find(line => line.toLowerCase().startsWith("ingredients:")) || "";
                let instructions = lines.find(line => line.toLowerCase().startsWith("instructions:")) || "";
                recipesHtml += `<div class="recipe-card">
                    <h3>${escapeHtml(title)}</h3>
                    <p><strong>${escapeHtml(ingredients)}</strong></p>
                    <p><strong>${escapeHtml(instructions)}</strong></p>
                </div>`;
            });
        }
        recipesHtml += '</div>';

        return tableHtml + recipesHtml;
    }

    function loadWeek(week) {
        fetch(week + ".txt")
            .then(response => {
                if (!response.ok) throw new Error("File not found.");
                return response.text();
            })
            .then(data => {
                document.getElementById("planContent").innerHTML = parseDietFileToHtml(data);
            })
            .catch(err => {
                document.getElementById("planContent").innerHTML = 
                    '<div class="error-msg">Sorry, diet plan not available for this week.</div>';
            });
    }
    document.getElementById("weekSelector").addEventListener("change", function() {
        loadWeek(this.value);
    });
    // Initial load
    loadWeek(document.getElementById("weekSelector").value);
    </script>
</body>
</html>
